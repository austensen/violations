library(tidyverse) 
library(magrittr)
library(stringr)

rpad_cols <- cols(
  BBLE = col_character(),
  BORO = col_integer(),
  BLOCK = col_integer(),
  LOT = col_integer(),
  EASE = col_character(),
  SECVOL = col_integer(),
  DISTRICT = col_integer(),
  YEAR4 = col_integer(),
  CUR.FV.L = col_double(),
  CUR.FV.T = col_double(),
  NEW.FV.L = col_double(),
  NEW.FV.T = col_double(),
  FV.CHGDT = col_character(),
  CURAVL = col_double(),
  CURAVT = col_double(),
  CUREXL = col_double(),
  CUREXT = col_double(),
  CURAVL.A = col_double(),
  CURAVT.A = col_double(),
  CUREXL.A = col_double(),
  CUREXT.A = col_double(),
  CHGDT = col_character(),
  TN.AVL = col_double(),
  TN.AVT = col_double(),
  TN.EXL = col_double(),
  TN.EXT = col_double(),
  TN.AVL.A = col_double(),
  TN.AVT.A = col_double(),
  TN.EXL.A = col_double(),
  TN.EXT.A = col_double(),
  FCHGDT = col_character(),
  FN.AVL = col_double(),
  FN.AVT = col_double(),
  FN.EXL = col_double(),
  FN.EXT = col_double(),
  FN.AVL.A = col_double(),
  FN.AVT.A = col_double(),
  FN.EXL.A = col_double(),
  FN.EXT.A = col_double(),
  TXCL = col_character(),
  O.TXCL = col_character(),
  CBN.TXCL = col_character(),
  BLDGCL = col_character(),
  EXMTCL = col_character(),
  OWNER = col_character(),
  HNUM.LO = col_character(),
  HNUM.HI = col_character(),
  STR.NAME = col_character(),
  ZIP = col_integer(),
  TOT.UNIT = col_integer(),
  RES.UNIT = col_integer(),
  LFRT.DEC = col_double(),
  LDEP.DEC = col_double(),
  L.ACRE = col_character(),
  IRREG = col_character(),
  BFRT.DEC = col_double(),
  BDEP.DEC = col_double(),
  BLD.VAR = col_character(),
  EXT = col_character(),
  STORY = col_double(),
  BLDGS = col_integer(),
  CORNER = col_character(),
  LND.AREA = col_integer(),
  GR.SQFT = col_integer(),
  ZONING = col_character(),
  YRB = col_integer(),
  YRB.FLAG = col_character(),
  YRB.RNG = col_integer(),
  YRA1 = col_integer(),
  YRA1.RNG = col_integer(),
  YRA2 = col_integer(),
  YRA2.RNG = col_integer(),
  CP.BORO = col_integer(),
  CP.DIST = col_integer(),
  LIMIT = col_integer(),
  O.LIMIT = col_integer(),
  STATUS1 = col_integer(),
  STATUS2 = col_character(),
  NEWLOT = col_integer(),
  DROPLOT = col_integer(),
  DELCHG = col_character(),
  CORCHG = col_integer(),
  NODESC = col_integer(),
  NOAV = col_integer(),
  VALREF = col_integer(),
  MBLDG = col_integer(),
  CONDO.NM = col_integer(),
  CONDO.S1 = col_character(),
  CONDO.S2 = col_integer(),
  CONDO.S3 = col_character(),
  CONDO.A = col_character(),
  COMINT.L = col_double(),
  COMINT.B = col_double(),
  APTNO = col_character(),
  AP.BORO = col_integer(),
  AP.BLOCK = col_integer(),
  AP.LOT = col_integer(),
  AP.EASE = col_character(),
  AP.DATE = col_character(),
  AP.TIME = col_integer(),
  PROTEST = col_character(),
  AT.GRP = col_integer(),
  APPLIC = col_integer(),
  PROTEST2 = col_character(),
  AT.GRP2 = col_integer(),
  APPLIC2 = col_integer(),
  O.PROTST = col_character(),
  O.AT.GRP = col_integer(),
  O.APPLIC = col_integer(),
  REUC = col_character(),
  GEO.RC = col_character(),
  COOP.NUM = col_integer(),
  EX.INDS = col_character(),
  EX.COUNT = col_integer(),
  EX.CHGDT = col_character(),
  DCHGDT = col_character(),
  SM.CHGDT = col_character()
)

rpad <- read_csv("data-raw/rpad/rpad_234_16.csv", col_types = rpad_cols) %>% 
  janitor::clean_names() %>% 
  filter(str_detect(txcl, "2"), is.na(ease), res_unit > 0) %>% 
  mutate(year_reno = pmax(yra1_rng, yra2_rng, na.rm = T),
         cd = (boro * 100) + cp_dist) %>% 
  select(boro, block, lot, cd, res_units = res_unit, year_built = yrb, year_reno, 
         stories = story, buildings = bldgs, gross_sqft = gr_sqft, zoning, building_class = bldgcl)
